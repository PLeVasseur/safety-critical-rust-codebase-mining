{
  "chapter": 7,
  "title": "Values",
  "fls_url": "https://rust-lang.github.io/fls/values.html",
  "fls_id": "fls_94a8v54bufn8",
  "repository": "eclipse-iceoryx/iceoryx2",
  "version": "0.8.0",
  "analysis_date": "2025-12-30",
  "version_changes": {
    "from_version": "0.7.0",
    "to_version": "0.8.0",
    "summary": "Significant increase in value-related constructs due to expanded FFI layer, no_std support, and new container types. static mut increased 367% (3->14) for logger restructuring. ManuallyDrop introduced (541 uses) for FFI ownership management.",
    "key_changes": [
      "Directory structure changed: iceoryx2-bb-*-0.7.0/ -> iceoryx2-bb/*/",
      "const declarations increased from 3025 to 3968 (+31%)",
      "static declarations increased from 52 to 85 (+63%)",
      "static mut increased from 3 to 14 (+367%) for logger split",
      "let bindings increased from 10877 to 14557 (+34%)",
      "let mut bindings increased from 1683 to 2338 (+39%)",
      "MaybeUninit usage increased from 146 to 219 (+50%)",
      "UnsafeCell usage increased from 189 to 231 (+22%)",
      "ManuallyDrop introduced (541 uses) for FFI ownership",
      "const fn increased significantly (113 instances)",
      "impl Drop increased from ~20 to 41 for FFI types"
    ]
  },
  "summary": "FLS Chapter 7 defines values - literals or computation results stored in memory locations and interpreted based on type. Covers constants, statics, temporaries, variables, and constant promotion.",
  "statistics": {
    "const_declarations": 3968,
    "static_declarations": 85,
    "static_mut": 14,
    "let_bindings": 14557,
    "let_mut_bindings": 2338,
    "unsafe_cell_usage": 231,
    "maybe_uninit_usage": 219,
    "manually_drop_usage": 541,
    "non_null_usage": 175,
    "const_fn_count": 113,
    "impl_drop_count": 41,
    "true": 1427,
    "false": 1184,
    "None": 678,
    "Some": 1294,
    "Ok": 2059,
    "Err": 918
  },
  "sections": {
    "constants": {
      "fls_section": "7.1",
      "fls_ids": [
        "fls_ixjc5jaamx84"
      ],
      "description": "Constants",
      "status": "demonstrated",
      "findings": {
        "legality_rules": {
          "7:1": "A value is either a literal or the result of a computation",
          "7:2": "An allocated object is a value stored at some memory address",
          "7:3": "Base address is the memory address where object is stored",
          "7:4": "Memory size is bytes spanned from base address"
        },
        "count": 3968,
        "change_from_v0_7_0": "+943 (+31%)",
        "usage_patterns": [
          "Configuration values (timeouts, sizes, limits)",
          "Numeric constants (buffer sizes, capacities)",
          "Duration constants for timing",
          "Permission bit flags",
          "Test fixture constants",
          "FFI constants for C interop"
        ],
        "undefined_behavior": {
          "7:10": "Creating value from uninitialized memory (except union)",
          "7:11": "Creating allocated object at null base address",
          "7:12": "Creating object where base + size > usize::MAX",
          "7:13": "Creating object where size > isize::MAX"
        },
        "null_checks": "NonNull<T> used extensively (175 uses) to prevent null pointers",
        "uninitialized_handling": "MaybeUninit<T> used (219 uses) for safe uninitialized memory",
        "ptr_null_usage": "ptr::null (24) and ptr::null_mut (141) for FFI interop"
      },
      "samples": [
        {
          "file": "iceoryx2-bb/posix/src/config.rs",
          "line": [32],
          "code": "pub const EINTR_REPETITIONS: u64 = 10;",
          "purpose": "Public constant defining maximum EINTR retry attempts"
        },
        {
          "file": "iceoryx2-cal/src/zero_copy_connection/mod.rs",
          "line": [142, 143, 144],
          "code": "pub const DEFAULT_BUFFER_SIZE: usize = 4;\npub const DEFAULT_ENABLE_SAFE_OVERFLOW: bool = false;\npub const DEFAULT_MAX_BORROWED_SAMPLES_PER_CHANNEL: usize = 4;",
          "purpose": "Module-level constants defining default configuration values"
        },
        {
          "file": "iceoryx2/src/constants.rs",
          "line": [14],
          "code": "pub const MAX_SERVICE_NAME_LENGTH: usize = 255;",
          "purpose": "Public constant defining maximum service name length limit"
        }
      ],
      "count": 3968
    },
    "statics": {
      "fls_section": "7.2",
      "fls_ids": [
        "fls_xdvdl2ssnhlo"
      ],
      "description": "Statics",
      "status": "demonstrated",
      "findings": {
        "legality_rules": {
          "7.2:1": "Static is value associated with specific memory location",
          "7.2:3": "Type specification shall have 'static lifetime",
          "7.2:6": "Mutable static is static with mut keyword, value can be modified",
          "7.2:7": "Access to mutable static requires unsafe context",
          "7.2:9": "Immutable static type shall implement core::marker::Sync",
          "7.2:12": "Static initializer expression shall be constant expression"
        },
        "undefined_behavior": {
          "7.2:18": "Mutating immutable static not subject to interior mutability"
        },
        "safety_patterns": {
          "atomics_for_sync": "AtomicUsize, AtomicBool, AtomicU8 for thread-safe state",
          "mutex_for_complex": "Mutex<T> for complex shared state",
          "oncecell_for_init": "OnceCell for one-time initialization",
          "lazy_static": "lazy_static! for complex initialization"
        },
        "immutable_statics": 71,
        "mutable_statics": 14,
        "change_from_v0_7_0": "static mut increased from 3 to 14 (+367%)",
        "with_atomics": "Primary pattern for thread-safe global state"
      },
      "samples": [
        {
          "file": "iceoryx2-bb/posix/src/signal.rs",
          "line": [280],
          "code": "static LAST_SIGNAL: AtomicUsize = AtomicUsize::new(posix::MAX_SIGNAL_VALUE);",
          "purpose": "Immutable static with interior mutability for thread-safe signal tracking"
        },
        {
          "file": "iceoryx2/src/node/mod.rs",
          "line": [536],
          "code": "static IN_CLEANUP_SECTION: AtomicBool = AtomicBool::new(false);",
          "purpose": "Immutable static with AtomicBool for cleanup state tracking"
        },
        {
          "file": "iceoryx2-log/log/src/lib.rs",
          "line": [147],
          "code": "static LOG_LEVEL: AtomicU8 = AtomicU8::new(DEFAULT_LOG_LEVEL as u8);",
          "purpose": "Immutable static for thread-safe log level configuration"
        },
        {
          "file": "iceoryx2-log/log/src/lib.rs",
          "line": [144],
          "code": "static mut LOGGER: Option<&'static dyn Log> = None;",
          "purpose": "Mutable static for global logger instance (requires unsafe access)"
        },
        {
          "file": "iceoryx2-cal/src/static_storage/process_local.rs",
          "line": [71, 72, 73],
          "code": "lazy_static! {\n    static ref PROCESS_LOCAL_MTX_HANDLE: MutexHandle<BTreeMap<FilePath, StorageEntry>> =\n        MutexHandle::new();",
          "purpose": "lazy_static! for complex initialization of process-local storage"
        }
      ],
      "count": 85
    },
    "temporaries": {
      "fls_section": "7.3",
      "fls_ids": [
        "fls_cleoffpn5ew6"
      ],
      "description": "Temporaries",
      "status": "demonstrated",
      "findings": {
        "description": "Temporaries are unnamed values created during expression evaluation. They have limited lifetime scope and are dropped at the end of their containing statement unless lifetime-extended.",
        "usage_patterns": [
          "Method chaining creates intermediate temporaries",
          "Builder pattern chains create temporary builder states",
          "Expression evaluation creates temporaries for intermediate results",
          "Unwrap chains create temporaries for Option/Result values"
        ],
        "lifetime_extension": "Temporaries bound to references with let have extended lifetime"
      },
      "samples": [
        {
          "file": "iceoryx2/src/service/attribute.rs",
          "line": [380],
          "code": "let key_exists = rhs.iter().any(|attr| attr.key == *key);",
          "purpose": "Iterator temporary created by .iter(), consumed by .any() method chain"
        },
        {
          "file": "iceoryx2/src/port/notifier.rs",
          "line": [228],
          "code": "for (i, index) in visited_indices.iter().enumerate() {",
          "purpose": "Temporary iterator with enumerate creates (usize, &T) tuples"
        },
        {
          "file": "iceoryx2/src/service/attribute.rs",
          "line": [438],
          "code": "self.iter().filter(|element| element.key() == key).count()",
          "purpose": "Method chain creates filter iterator temporary, consumed by count"
        }
      ],
      "count": null,
      "count_methodology": "Conceptual - temporaries are implicit"
    },
    "variables": {
      "fls_section": "7.4",
      "fls_ids": [
        "fls_gho955gmob73"
      ],
      "description": "Variables",
      "status": "demonstrated",
      "findings": {
        "legality_rules": {
          "7.4:1": "Variable is placeholder for value allocated on stack",
          "7.4:2": "Variables are bindings or temporaries",
          "7.4:5": "Variable shall be used only after initialized through all reachable paths",
          "7.4:6": "Variable is not initialized when allocated"
        },
        "let_bindings": 14557,
        "let_mut_bindings": 2338,
        "ratio": "16.1% of bindings are mutable",
        "change_from_v0_7_0": "+3680 let bindings (+34%), +655 let mut bindings (+39%)"
      },
      "samples": [
        {
          "file": "iceoryx2/src/port/notifier.rs",
          "line": [135, 136, 137, 138, 139],
          "code": "let mut new_self = Self {\n    connections: vec![],\n    service_state,\n    list_state,\n};",
          "purpose": "Mutable binding for struct construction with later modification"
        },
        {
          "file": "iceoryx2/src/port/server.rs",
          "line": [175],
          "code": "let mut result = Ok(());",
          "purpose": "Mutable binding initialized to Ok for accumulating operation results"
        },
        {
          "file": "iceoryx2/src/config.rs",
          "line": [237, 238],
          "code": "let mut path = *self.root_path();\npath.add_path_entry(&self.service.directory).unwrap();",
          "purpose": "Mutable binding for path construction with method mutation"
        }
      ],
      "subsections": {
        "constant_promotion": {
          "fls_section": "7.4.1",
          "fls_ids": [
            "fls_wttihxen35as"
          ],
          "description": "Constant Promotion",
          "status": "demonstrated",
          "findings": {
            "description": "Constant promotion allows certain expressions to be promoted to static memory. In iceoryx2, this occurs implicitly with literal references and const-evaluable expressions.",
            "patterns": [
              "Literal array references (&[1, 2, 3]) promoted to 'static",
              "const fn results used in static contexts",
              "Compile-time string literals"
            ]
          },
          "samples": [
            {
              "file": "iceoryx2-bb/elementary/src/package_version.rs",
              "line": [67, 68, 69, 70],
              "code": "const MAJOR: u16 = 0;\nconst MINOR: u16 = 8;\nconst PATCH: u16 = 0;\n\nPackageVersion::from_version(MAJOR, MINOR, PATCH)",
              "purpose": "Local constants in const fn enabling compile-time version construction"
            },
            {
              "file": "iceoryx2/src/service/builder/mod.rs",
              "line": [480, 481],
              "code": ".has_ownership(true)\n.create(&[])",
              "purpose": "Empty slice literal &[] promoted to 'static lifetime for service creation"
            },
            {
              "file": "iceoryx2-cal/src/shm_allocator/pointer_offset.rs",
              "line": [51],
              "code": "const SEGMENT_ID: u8 = 0;",
              "purpose": "Local const in Default impl for compile-time segment ID"
            }
          ],
          "count": 3964
        }
      },
      "count": 14965
    }
  },
  "safety_critical_summary": {
    "items_not_used": {
      "expressions_not_used": {
        "unnamed_constants": "const _: Type = value; pattern not found",
        "external_statics": "extern static not found (no C FFI statics imported)"
      }
    }
  }
}