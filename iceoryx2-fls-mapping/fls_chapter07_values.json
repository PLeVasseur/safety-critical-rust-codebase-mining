{
  "chapter": 7,
  "title": "Values",
  "fls_url": "https://rust-lang.github.io/fls/values.html",
  "fls_id": "fls_94a8v54bufn8",
  "repository": "eclipse-iceoryx/iceoryx2",
  "version": "0.8.0",
  "analysis_date": "2025-12-30",
  "version_changes": {
    "from_version": "0.7.0",
    "to_version": "0.8.0",
    "summary": "Significant increase in value-related constructs due to expanded FFI layer, no_std support, and new container types. static mut increased 367% (3->14) for logger restructuring. ManuallyDrop introduced (541 uses) for FFI ownership management.",
    "key_changes": [
      "Directory structure changed: iceoryx2-bb-*-0.7.0/ -> iceoryx2-bb/*/",
      "const declarations increased from 3025 to 3968 (+31%)",
      "static declarations increased from 52 to 85 (+63%)",
      "static mut increased from 3 to 14 (+367%) for logger split",
      "let bindings increased from 10877 to 14557 (+34%)",
      "let mut bindings increased from 1683 to 2338 (+39%)",
      "MaybeUninit usage increased from 146 to 219 (+50%)",
      "UnsafeCell usage increased from 189 to 231 (+22%)",
      "ManuallyDrop introduced (541 uses) for FFI ownership",
      "const fn increased significantly (113 instances)",
      "impl Drop increased from ~20 to 41 for FFI types"
    ]
  },
  "summary": "FLS Chapter 7 defines values - literals or computation results stored in memory locations and interpreted based on type. Covers constants, statics, temporaries, variables, and constant promotion.",
  "statistics": {
    "const_declarations": 3968,
    "static_declarations": 85,
    "static_mut": 14,
    "let_bindings": 14557,
    "let_mut_bindings": 2338,
    "unsafe_cell_usage": 231,
    "maybe_uninit_usage": 219,
    "manually_drop_usage": 541,
    "non_null_usage": 175,
    "const_fn_count": 113,
    "impl_drop_count": 41,
    "true": 1427,
    "false": 1184,
    "None": 678,
    "Some": 1294,
    "Ok": 2059,
    "Err": 918
  },
  "sections": {
    "constants": {
      "fls_section": "7.1",
      "fls_ids": [
        "fls_ixjc5jaamx84"
      ],
      "description": "Constants",
      "status": "demonstrated",
      "findings": {
        "legality_rules": {
          "7:1": "A value is either a literal or the result of a computation",
          "7:2": "An allocated object is a value stored at some memory address",
          "7:3": "Base address is the memory address where object is stored",
          "7:4": "Memory size is bytes spanned from base address"
        },
        "count": 3968,
        "change_from_v0_7_0": "+943 (+31%)",
        "usage_patterns": [
          "Configuration values (timeouts, sizes, limits)",
          "Numeric constants (buffer sizes, capacities)",
          "Duration constants for timing",
          "Permission bit flags",
          "Test fixture constants",
          "FFI constants for C interop"
        ],
        "undefined_behavior": {
          "7:10": "Creating value from uninitialized memory (except union)",
          "7:11": "Creating allocated object at null base address",
          "7:12": "Creating object where base + size > usize::MAX",
          "7:13": "Creating object where size > isize::MAX"
        },
        "null_checks": "NonNull<T> used extensively (175 uses) to prevent null pointers",
        "uninitialized_handling": "MaybeUninit<T> used (219 uses) for safe uninitialized memory",
        "ptr_null_usage": "ptr::null (24) and ptr::null_mut (141) for FFI interop"
      },
      "samples": [
        {
          "file": "iceoryx2-bb/posix/src/config.rs",
          "line": [
            32
          ],
          "code": "pub const EINTR_REPETITIONS: u64 = 10;"
        },
        {
          "file": "iceoryx2-bb/posix/src/config.rs",
          "line": [
            34
          ],
          "code": "pub const MAX_THREAD_NAME_LENGTH: usize = 16;"
        },
        {
          "file": "iceoryx2-bb/posix/src/config.rs",
          "line": [
            37
          ],
          "code": "pub const ADAPTIVE_WAIT_YIELD_REPETITIONS: u64 = 10000;"
        },
        {
          "file": "iceoryx2-bb/posix/src/config.rs",
          "line": [
            38
          ],
          "code": "pub const ADAPTIVE_WAIT_INITIAL_REPETITIONS: u64 = 100 + ADAPTIVE_WAIT_YIELD_REPETITIONS;"
        },
        {
          "file": "iceoryx2-bb/memory/tests/pool_allocator_tests.rs",
          "line": [
            65,
            66
          ],
          "code": "const BUCKET_SIZE: usize = 128;\nconst BUCKET_ALIGNMENT: usize = 1;"
        },
        {
          "file": "iceoryx2-bb/memory/tests/pool_allocator_tests.rs",
          "line": [
            56
          ],
          "code": "NonNull::new(self.get_mut_memory()).unwrap()"
        },
        {
          "file": "iceoryx2-bb/memory/src/bump_allocator.rs",
          "line": [
            48
          ],
          "code": "pub fn new(ptr: NonNull<u8>, size: usize) -> Self {"
        }
      ]
    },
    "statics": {
      "fls_section": "7.2",
      "fls_ids": [
        "fls_xdvdl2ssnhlo"
      ],
      "description": "Statics",
      "status": "demonstrated",
      "findings": {
        "legality_rules": {
          "7.2:1": "Static is value associated with specific memory location",
          "7.2:3": "Type specification shall have 'static lifetime",
          "7.2:6": "Mutable static is static with mut keyword, value can be modified",
          "7.2:7": "Access to mutable static requires unsafe context",
          "7.2:9": "Immutable static type shall implement core::marker::Sync",
          "7.2:12": "Static initializer expression shall be constant expression"
        },
        "undefined_behavior": {
          "7.2:18": "Mutating immutable static not subject to interior mutability"
        },
        "safety_patterns": {
          "atomics_for_sync": "AtomicUsize, AtomicBool, AtomicU8 for thread-safe state",
          "mutex_for_complex": "Mutex<T> for complex shared state",
          "oncecell_for_init": "OnceCell for one-time initialization",
          "lazy_static": "lazy_static! for complex initialization"
        },
        "immutable_statics": 71,
        "mutable_statics": 14,
        "change_from_v0_7_0": "static mut increased from 3 to 14 (+367%)",
        "with_atomics": "Primary pattern for thread-safe global state"
      },
      "samples": [
        {
          "file": "iceoryx2-bb/posix/tests/signal_tests.rs",
          "line": [
            28,
            29,
            30
          ],
          "code": "static COUNTER: AtomicUsize = AtomicUsize::new(0);\nstatic SIGNAL: AtomicUsize = AtomicUsize::new(posix::MAX_SIGNAL_VALUE);\nstatic LOCK: Mutex<i32> = Mutex::new(0);",
          "purpose": "immutable_statics: static declaration"
        },
        {
          "file": "iceoryx2/src/node/mod.rs",
          "line": [
            536
          ],
          "code": "static IN_CLEANUP_SECTION: AtomicBool = AtomicBool::new(false);",
          "purpose": "immutable_statics: static declaration"
        },
        {
          "file": "iceoryx2-pal/posix/src/linux/errno.rs",
          "line": [
            162
          ],
          "code": "static IS_LOCKED: AtomicBool = AtomicBool::new(false);",
          "purpose": "immutable_statics: static declaration"
        },
        {
          "file": "examples/rust/service_types/local_pubsub.rs",
          "line": [
            24
          ],
          "code": "static KEEP_RUNNING: AtomicBool = AtomicBool::new(true);",
          "purpose": "immutable_statics: static declaration"
        },
        {
          "file": "iceoryx2-pal/posix/src/windows/socket.rs",
          "line": [
            51,
            52
          ],
          "code": "static mut WSA_INSTANCE: OnceCell<GlobalWsaInitializer> = OnceCell::new();\nstatic mut INITIALIZATION_STATE: AtomicU8 = AtomicU8::new(0);",
          "purpose": "mutable_statics: static declaration"
        },
        {
          "file": "iceoryx2-log/log/src/lib.rs",
          "line": [
            144
          ],
          "code": "static mut LOGGER: Option<&'static dyn Log> = None;",
          "purpose": "mutable_statics: static declaration"
        },
        {
          "file": "iceoryx2-ffi/c/src/api/log.rs",
          "line": [
            79
          ],
          "code": "static mut LOGGER: Option<CLogger> = None;",
          "purpose": "mutable_statics: static declaration"
        },
        {
          "file": "iceoryx2-cal/src/static_storage/process_local.rs",
          "line": [
            71
          ],
          "code": "lazy_static! {",
          "purpose": "lazy_static: static declaration"
        },
        {
          "file": "iceoryx2-cal/src/communication_channel/process_local.rs",
          "line": [
            55
          ],
          "code": "lazy_static! {",
          "purpose": "lazy_static: static declaration"
        }
      ]
    },
    "temporaries": {
      "fls_section": "7.3",
      "fls_ids": [
        "fls_cleoffpn5ew6"
      ],
      "description": "Temporaries",
      "status": "demonstrated",
      "findings": {
        "description": "Temporaries are unnamed values created during expression evaluation. They have limited lifetime scope and are dropped at the end of their containing statement unless lifetime-extended.",
        "usage_patterns": [
          "Method chaining creates intermediate temporaries",
          "Builder pattern chains create temporary builder states",
          "Expression evaluation creates temporaries for intermediate results",
          "Unwrap chains create temporaries for Option/Result values"
        ],
        "lifetime_extension": "Temporaries bound to references with let have extended lifetime"
      },
      "samples": [
        {
          "file": "iceoryx2-bb/memory/tests/pool_allocator_tests.rs",
          "line": [
            50
          ],
          "code": "(TestFixture::memory_size() / core::cmp::max(size, align)) as u32 - 1",
          "purpose": "Arithmetic expression creates temporaries for intermediate values"
        },
        {
          "file": "iceoryx2-bb/linux/tests/signal_fd_tests.rs",
          "line": [
            34
          ],
          "code": "let sut = SignalFdBuilder::new(signals).create_non_blocking().unwrap();",
          "purpose": "Builder pattern creates temporary SignalFdBuilder"
        },
        {
          "file": "iceoryx2-bb/linux/tests/signal_fd_tests.rs",
          "line": [
            46
          ],
          "code": "assert_that!(signal.origin_pid(), eq Process::from_self().id());",
          "purpose": "Method chain creates temporary Process instance"
        }
      ]
    },
    "variables": {
      "fls_section": "7.4",
      "fls_ids": [
        "fls_gho955gmob73"
      ],
      "description": "Variables",
      "status": "demonstrated",
      "findings": {
        "legality_rules": {
          "7.4:1": "Variable is placeholder for value allocated on stack",
          "7.4:2": "Variables are bindings or temporaries",
          "7.4:5": "Variable shall be used only after initialized through all reachable paths",
          "7.4:6": "Variable is not initialized when allocated"
        },
        "let_bindings": 14557,
        "let_mut_bindings": 2338,
        "ratio": "16.1% of bindings are mutable",
        "change_from_v0_7_0": "+3680 let bindings (+34%), +655 let mut bindings (+39%)"
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/allocator.rs",
          "line": [
            56
          ],
          "code": "let memory = self.allocate(layout)?;",
          "purpose": "immutable_bindings: let memory = self.allocate(layout)?;..."
        },
        {
          "file": "iceoryx2-bb/memory/tests/pool_allocator_tests.rs",
          "line": [
            68
          ],
          "code": "let sut = test.create_pool_allocator(BUCKET_SIZE, BUCKET_ALIGNMENT);",
          "purpose": "immutable_bindings: let sut = test.create_pool_allocator(BUCKET_SIZE, ..."
        },
        {
          "file": "iceoryx2-bb/posix/tests/unix_datagram_socket_tests.rs",
          "line": [
            36
          ],
          "code": "let mut file = FileName::new(b\"unix_datagram_socket_tests\").unwrap();",
          "purpose": "mutable_bindings: let mut file = FileName::new(b\"unix_datagram_socke..."
        },
        {
          "file": "iceoryx2-bb/posix/tests/unix_datagram_socket_tests.rs",
          "line": [
            110
          ],
          "code": "let mut receive_data: Vec<u8> = vec![0; 6];",
          "purpose": "mutable_bindings: let mut receive_data: Vec<u8> = vec![0; 6];..."
        }
      ],
      "subsections": {
        "constant_promotion": {
          "fls_section": "7.4.1",
          "fls_ids": [
            "fls_wttihxen35as"
          ],
          "description": "Constant Promotion",
          "status": "demonstrated",
          "findings": {
            "description": "Constant promotion allows certain expressions to be promoted to static memory. In iceoryx2, this occurs implicitly with literal references and const-evaluable expressions.",
            "patterns": [
              "Literal array references (&[1, 2, 3]) promoted to 'static",
              "const fn results used in static contexts",
              "Compile-time string literals"
            ]
          },
          "samples": [
            {
              "file": "iceoryx2-userland/record-and-replay/tests/recorder_tests.rs",
              "line": [
                73,
                74,
                75
              ],
              "code": "system_header: &[0u8; 8],\nuser_header: &[0u8; 0],\npayload: &[0u8; 8],",
              "purpose": "Literal arrays promoted to static lifetime for test fixtures"
            }
          ]
        }
      }
    }
  },
  "safety_critical_summary": {
    "items_not_used": {
      "expressions_not_used": {
        "unnamed_constants": "const _: Type = value; pattern not found",
        "external_statics": "extern static not found (no C FFI statics imported)"
      }
    }
  }
}