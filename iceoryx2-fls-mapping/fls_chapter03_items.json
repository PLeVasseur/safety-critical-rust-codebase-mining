{
  "chapter": 3,
  "title": "Items",
  "fls_url": "https://rust-lang.github.io/fls/items.html",
  "fls_id": "fls_wb86edg02t6a",
  "repository": "eclipse-iceoryx/iceoryx2",
  "version": "0.8.0",
  "analysis_date": "2024-12-30",
  "version_changes": {
    "from_version": "0.7.0",
    "to_version": "0.8.0",
    "summary": "Significant expansion in v0.8.0: new FFI layer (iceoryx2-ffi), logger restructured (iceoryx2-log), no_std support added, union types introduced",
    "key_changes": [
      "Union types now used in FFI layer (0 -> 42 occurrences)",
      "static mut increased (3 -> 14) due to logger restructuring",
      "extern blocks increased (48 -> 11+ in pal layer) with expanded FFI",
      "extern crate increased (20 -> 324) due to no_std support",
      "Function count doubled (4603 -> 10194)",
      "unsafe impl count increased (80+ -> 219)"
    ]
  },
  "summary": "FLS Chapter 3 defines Items as the building blocks of a Rust program. Items are declarations that introduce names and define types, functions, modules, and other constructs. This mapping covers all item categories found in iceoryx2.",
  "statistics": {
    "constant_declaration": 4122,
    "enum_declaration": 407,
    "external_block": 11,
    "external_crate_import": 324,
    "function_declaration": 8810,
    "implementation": 2554,
    "macro_rules_declaration": 27,
    "module_declaration": 1022,
    "static_declaration": 85,
    "static_mut_declaration": 14,
    "struct_declaration": 1079,
    "terminated_macro_invocation": 8492,
    "trait_declaration": 126,
    "type_alias_declaration": 1204,
    "union_declaration": 42,
    "use_import": 5854
  },
  "sections": {
    "constant_declaration": {
      "fls_section": "3.0.1",
      "fls_ids": [],
      "description": "Constant Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2/src/constants.rs",
          "line": [
            14
          ],
          "code": "pub const MAX_SERVICE_NAME_LENGTH: usize = 255;",
          "purpose": "Configuration constant"
        }
      ],
      "safety_notes": [
        "Constants are evaluated at compile time - no runtime cost",
        "const fn enables compile-time computation of memory sizes",
        "Size constants (MAX_*) define system limits - important for static analysis",
        "NEW: Unchecked const creation functions added for SemanticString types (#1109)"
      ]
    },
    "enum_declaration": {
      "fls_section": "3.0.2",
      "fls_ids": [],
      "description": "Enum Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2/src/service/service_name.rs",
          "line": [
            44,
            45,
            46
          ],
          "code": "pub enum ServiceNameError { InvalidContent, ExceedsMaximumLength }",
          "purpose": "Error enum"
        }
      ],
      "safety_notes": [
        "#[repr(u32)] and #[repr(i32)] ensure ABI-stable discriminant types",
        "Error enums follow Result<T, E> pattern for explicit error handling",
        "Generic enums (NodeState<Service>) maintain type safety across variants",
        "Discriminant values are explicitly controlled for FFI compatibility"
      ]
    },
    "external_block": {
      "fls_section": "3.0.3",
      "fls_ids": [],
      "description": "External Block",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-pal/posix/src/linux/pthread.rs",
          "line": [
            255,
            256
          ],
          "code": "extern \"C\" { pub fn pthread_attr_setaffinity_np(...) }",
          "purpose": "POSIX FFI binding"
        }
      ],
      "safety_notes": [
        "All extern blocks are for POSIX/platform APIs",
        "Functions are pub(super) - restricted visibility",
        "Platform-specific implementations (macos, linux, qnx, freebsd, windows)",
        "No unsafe extern blocks (functions implicitly unsafe)",
        "Custom C helper functions (iceoryx2_cmsg_*) for platform compatibility"
      ]
    },
    "external_crate_import": {
      "fls_section": "3.0.4",
      "fls_ids": [],
      "description": "External Crate Import",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/lib.rs",
          "line": [
            17
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2/src/lib.rs",
          "line": [
            513
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2/src/port/writer.rs",
          "line": [
            61
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2/src/port/reader.rs",
          "line": [
            56
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2-log/log/src/lib.rs",
          "line": [
            145
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2-cal/src/lib.rs",
          "line": [
            17
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2-bb/container/src/lib.rs",
          "line": [
            91
          ],
          "code": "extern crate alloc;"
        },
        {
          "file": "iceoryx2-bb/derive-macros/src/lib.rs",
          "line": [
            19
          ],
          "code": "extern crate proc_macro;"
        },
        {
          "file": "iceoryx2-log/loggers/src/lib.rs",
          "line": [],
          "code": "extern crate iceoryx2_log;"
        }
      ],
      "safety_notes": [
        "extern crate alloc - for #![no_std] support with heap allocation",
        "extern crate proc_macro - only in derive macro crate",
        "extern crate iceoryx2_loggers - NEW: logger backend linkage requirement",
        "SIGNIFICANT INCREASE (20 -> 324) due to explicit core/alloc imports for no_std support (#865)",
        "alloc usage indicates no_std compatible design"
      ]
    },
    "function_declaration": {
      "fls_section": "3.0.5",
      "fls_ids": [],
      "description": "Function Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [],
      "safety_notes": [
        "No async functions - synchronous IPC design",
        "unsafe fn count significantly increased (200+ -> 1763) due to FFI layer",
        "extern \"C\" fn count significantly increased due to C/C++ bindings",
        "All extern \"C\" functions are critical for FFI correctness",
        "FFI functions marked as pub unsafe extern \"C\" following best practices"
      ]
    },
    "implementation": {
      "fls_section": "3.0.6",
      "fls_ids": [],
      "description": "Implementation",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            52
          ],
          "code": "unsafe impl ZeroCopySend for usize {}"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            53,
            54,
            55,
            56,
            57,
            58,
            59,
            60,
            61,
            62,
            63,
            64
          ],
          "code": "unsafe impl ZeroCopySend for u8 {} ... unsafe impl ZeroCopySend for i128 {}"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            66,
            67
          ],
          "code": "unsafe impl ZeroCopySend for f32 {} unsafe impl ZeroCopySend for f64 {}"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            69,
            70
          ],
          "code": "unsafe impl ZeroCopySend for char {} unsafe impl ZeroCopySend for bool {}"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            72,
            73,
            74,
            75
          ],
          "code": "unsafe impl ZeroCopySend for IoxAtomicUsize {} ... IoxAtomicU32 {}"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            89
          ],
          "code": "unsafe impl<T: ZeroCopySend, const N: usize> ZeroCopySend for [T; N] {}"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/placement_default.rs",
          "line": [
            115
          ],
          "code": "impl<T: PlacementDefault, const CAPACITY: usize> PlacementDefault for [T; CAPACITY] {"
        }
      ],
      "safety_notes": [
        "unsafe impl required for ZeroCopySend marker trait",
        "All primitive types have unsafe impl ZeroCopySend",
        "Atomic types (IoxAtomic*) correctly marked as ZeroCopySend",
        "Generic impl with const generics ([T; N]) properly constrained",
        "NEW: 219 unsafe impl (increased from 80+) - expanded FFI layer"
      ]
    },
    "module_declaration": {
      "fls_section": "3.0.7",
      "fls_ids": [],
      "description": "Module Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/lib.rs",
          "line": [
            19
          ],
          "code": "pub mod allocator;"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/lib.rs",
          "line": [
            22,
            23,
            24,
            25,
            26,
            27
          ],
          "code": "pub mod generic_pointer; ... pub mod zero_copy_send;"
        },
        {
          "file": "iceoryx2/src/lib.rs",
          "line": [
            518,
            519,
            520,
            521
          ],
          "code": "pub mod config; ... pub mod node;"
        },
        {
          "file": "iceoryx2/src/node/mod.rs",
          "line": [
            143
          ],
          "code": "pub mod node_name;"
        },
        {
          "file": "iceoryx2/src/node/mod.rs",
          "line": [
            146
          ],
          "code": "pub mod testing;"
        },
        {
          "file": "iceoryx2-ffi/c/src/api/mod.rs",
          "line": [],
          "code": "pub mod node; pub mod publisher; ... (FFI modules)"
        }
      ],
      "safety_notes": [
        "No unsafe modules declared",
        "Test modules kept private (mod tests pattern)",
        "Internal modules use mod without pub for encapsulation",
        "NEW: iceoryx2-ffi adds many modules for C/C++ bindings"
      ]
    },
    "static_declaration": {
      "fls_section": "3.0.8",
      "fls_ids": [],
      "description": "Static Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-pal/posix/src/windows/errno.rs",
          "line": [
            142
          ],
          "code": "pub static GLOBAL_ERRNO_VALUE: Cell<u32> = const { Cell::new(Errno::ESUCCES as _) };"
        }
      ],
      "safety_notes": [
        "CRITICAL: 14 static mut declarations (increased from 3 in v0.7.0)",
        "static mut LOGGER - now in multiple locations due to logger restructuring",
        "static mut STDOUT/STDERR - new logger backend infrastructure",
        "static mut in FFI layer - C logger callback storage",
        "static mut WSA_INSTANCE - Windows socket initialization, platform-specific",
        "static mut INITIALIZATION_STATE - atomic, but still static mut",
        "Cell<u32> pattern used for thread-local errno without static mut"
      ]
    },
    "struct_declaration": {
      "fls_section": "3.0.9",
      "fls_ids": [],
      "description": "Struct Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/posix/src/mutex.rs",
          "line": [
            507,
            508
          ],
          "code": "pub struct Mutex<'this, 'handle: 'this, T: Debug> { ... }",
          "purpose": "POSIX mutex wrapper"
        }
      ],
      "safety_notes": [
        "#[repr(C)] used for FFI-compatible layout (memory layout determinism)",
        "#[repr(transparent)] used for newtype patterns ensuring same layout as inner type",
        "Generic structs with trait bounds (Service: service::Service) for type safety",
        "Lifetime parameters ('waitset, 'attachment) for borrow checking",
        "pub(crate) visibility for internal implementation details",
        "NEW: StaticVec and StaticString replace FixedSizeVec/FixedSizeByteString with better no_std support"
      ]
    },
    "trait_declaration": {
      "fls_section": "3.0.10",
      "fls_ids": [],
      "description": "Trait Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/zero_copy_send.rs",
          "line": [
            32
          ],
          "code": "pub unsafe trait ZeroCopySend { }",
          "purpose": "Zero-copy safety trait"
        }
      ],
      "safety_notes": [
        "Only ONE unsafe trait defined (ZeroCopySend) - requires careful review",
        "Trait bounds (Send + Sync) enforce thread-safety at compile time",
        "Supertraits create inheritance hierarchies for capability composition",
        "Object-safe traits enable dyn usage (Log: Send + Sync)",
        "NEW: Log trait moved to iceoryx2-log/log crate (frontend/backend split)"
      ]
    },
    "type_alias_declaration": {
      "fls_section": "3.0.11",
      "fls_ids": [],
      "description": "Type Alias Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2/src/port/event_id.rs",
          "line": [
            42
          ],
          "code": "pub type EventId = iceoryx2_cal::event::TriggerId;"
        },
        {
          "file": "iceoryx2/src/service/static_config/message_type_details.rs",
          "line": [
            54
          ],
          "code": "pub type TypeNameString = StaticString<MAX_TYPE_NAME_LENGTH>;"
        },
        {
          "file": "iceoryx2/src/service/attribute.rs",
          "line": [
            141
          ],
          "code": "pub type AttributeKey = key::FixedString;"
        },
        {
          "file": "iceoryx2/src/service/attribute.rs",
          "line": [
            174
          ],
          "code": "pub type AttributeValue = value::FixedString;"
        },
        {
          "file": "iceoryx2-bb/lock-free/src/mpmc/bit_set.rs",
          "line": [
            53
          ],
          "code": "pub type BitSet = details::BitSet<OwningPointer<details::BitsetElement>>;"
        },
        {
          "file": "iceoryx2-bb/lock-free/src/mpmc/bit_set.rs",
          "line": [
            55
          ],
          "code": "pub type RelocatableBitSet = details::BitSet<RelocatablePointer<details::BitsetElement>>;"
        },
        {
          "file": "iceoryx2-bb/lock-free/src/spsc/index_queue.rs",
          "line": [
            96,
            97
          ],
          "code": "pub type IndexQueue = details::IndexQueue<OwningPointer<...>>; pub type RelocatableIndexQueue = ..."
        },
        {
          "file": "iceoryx2-cal/src/dynamic_storage/recommended.rs",
          "line": [
            16
          ],
          "code": "pub type Ipc<T> = crate::dynamic_storage::posix_shared_memory::Storage<T>;"
        },
        {
          "file": "iceoryx2-cal/src/dynamic_storage/recommended.rs",
          "line": [
            21
          ],
          "code": "pub type Local<T> = crate::dynamic_storage::process_local::Storage<T>;"
        },
        {
          "file": "iceoryx2-cal/src/zero_copy_connection/recommended.rs",
          "line": [
            16
          ],
          "code": "pub type Ipc = crate::zero_copy_connection::posix_shared_memory::Connection;"
        },
        {
          "file": "iceoryx2-cal/src/zero_copy_connection/recommended.rs",
          "line": [
            21
          ],
          "code": "pub type Local = crate::zero_copy_connection::process_local::Connection;"
        }
      ],
      "safety_notes": [
        "Type aliases provide abstraction without runtime cost",
        "Platform-specific aliases (Ipc vs Local) enable compile-time platform selection",
        "Generic type aliases preserve type constraints through the alias",
        "NEW: TypeNameString now uses StaticString instead of FixedSizeByteString"
      ]
    },
    "union_declaration": {
      "fls_section": "3.0.12",
      "fls_ids": [],
      "description": "Union Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-ffi/c/src/api/writer.rs",
          "line": [
            50,
            51
          ],
          "code": "pub union WriterUnion { ipc: ManuallyDrop<...>, local: ManuallyDrop<...> }",
          "purpose": "FFI union"
        }
      ],
      "safety_notes": [
        "CHANGED from v0.7.0: Union types NOW USED (previously none)",
        "Union access is inherently unsafe (requires unsafe block)",
        "All unions are in FFI layer (iceoryx2-ffi/c) for C interop",
        "ZeroCopySend now supports unions (#1144)",
        "Review required: ensure all union accesses have proper safety justifications"
      ]
    },
    "use_import": {
      "fls_section": "3.0.13",
      "fls_ids": [],
      "description": "Use Import",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/allocator.rs",
          "line": [
            16
          ],
          "code": "pub use core::{alloc::Layout, ptr::NonNull};"
        },
        {
          "file": "iceoryx2-bb/elementary-traits/src/lib.rs",
          "line": [
            21
          ],
          "code": "pub use crate::as_cstr::*;"
        },
        {
          "file": "iceoryx2/src/prelude.rs",
          "line": [
            13
          ],
          "code": "pub use crate::config::Config;"
        },
        {
          "file": "iceoryx2/src/prelude.rs",
          "line": [
            14
          ],
          "code": "pub use crate::node::{node_name::NodeName, Node, NodeBuilder, NodeState};"
        },
        {
          "file": "iceoryx2/src/prelude.rs",
          "line": [
            17,
            18,
            19,
            20,
            21
          ],
          "code": "pub use crate::service::{ ... };"
        },
        {
          "file": "iceoryx2/src/prelude.rs",
          "line": [
            24
          ],
          "code": "pub use iceoryx2_bb_container::semantic_string::SemanticString;"
        },
        {
          "file": "iceoryx2/src/prelude.rs",
          "line": [
            26,
            27
          ],
          "code": "pub use iceoryx2_bb_derive_macros::PlacementDefault; pub use ... ZeroCopySend;"
        }
      ],
      "safety_notes": [
        "Glob imports limited to internal atomic types",
        "prelude.rs provides curated public API surface",
        "pub use re-exports maintain stable API boundaries",
        "SIGNIFICANT INCREASE (1960 -> 6647) due to no_std explicit imports"
      ]
    },
    "macro_rules_declaration": {
      "fls_section": "3.0.14",
      "fls_ids": [],
      "description": "Macro Rules Declaration",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": [
        {
          "file": "iceoryx2-bb/elementary-traits/src/allocator.rs",
          "line": [
            19
          ],
          "code": "#[derive(Debug, Clone, Copy, Eq, Hash, PartialEq)]"
        },
        {
          "file": "iceoryx2/src/signal_handling_mode.rs",
          "line": [
            15
          ],
          "code": "#[derive(Default, Debug, Clone, Copy, PartialEq, Eq)]"
        },
        {
          "file": "iceoryx2/src/node/node_name.rs",
          "line": [
            23
          ],
          "code": "#[derive(Debug, Clone, PartialEq, Eq, Hash, PartialOrd, Ord)]"
        },
        {
          "file": "iceoryx2/src/node/mod.rs",
          "line": [
            226
          ],
          "code": "#[derive(Debug, Copy, Clone, PartialEq, Eq)]"
        },
        {
          "file": "iceoryx2/src/node/mod.rs",
          "line": [
            315
          ],
          "code": "#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]"
        },
        {
          "file": "iceoryx2-bb/container/src/string/static_string.rs",
          "line": [
            58
          ],
          "code": "#[derive(PlacementDefault, ZeroCopySend, Clone, Copy)] (NEW: StaticString implements Copy)"
        }
      ],
      "safety_notes": [
        "Derive macros reduce manual implementation errors",
        "serde derives enable configuration serialization",
        "Custom derives (PlacementDefault, ZeroCopySend) for safety-critical traits",
        "NEW: Copy now derived for StaticString, SemanticString (#1114)"
      ]
    },
    "terminated_macro_invocation": {
      "fls_section": "3.0.15",
      "fls_ids": [],
      "description": "Terminated Macro Invocation",
      "status": "demonstrated",
      "findings": {
        "analyzed": true
      },
      "samples": []
    }
  },
  "safety_critical_summary": {
    "items_not_used": {
      "async_functions": "No async fn - synchronous design simplifies reasoning",
      "pub_in_path": "No pub(in path) - simplified visibility model"
    },
    "items_changed_in_v0_8_0": {
      "unions": {
        "v0_7_0": 0,
        "v0_8_0": 42,
        "change": "NEW - union types for FFI layer and ZeroCopySend tests",
        "risk": "MEDIUM - union access is unsafe"
      },
      "static_mut": {
        "v0_7_0": 3,
        "v0_8_0": 14,
        "change": "+11 - logger restructuring and FFI",
        "risk": "HIGH - mutable static access requires unsafe"
      },
      "unsafe_impl": {
        "v0_7_0": "~80",
        "v0_8_0": 219,
        "change": "+139 - expanded FFI layer",
        "risk": "MEDIUM - verify all unsafe impl are justified"
      },
      "unsafe_fn": {
        "v0_7_0": "~200",
        "v0_8_0": 1763,
        "change": "+1563 - FFI functions",
        "risk": "MEDIUM - concentrated in FFI layer"
      },
      "functions_total": {
        "v0_7_0": 4603,
        "v0_8_0": 10194,
        "change": "+5591 (121% increase)",
        "note": "Growth due to FFI bindings expansion"
      }
    },
    "items_requiring_review": {
      "static_mut": {
        "count": 14,
        "locations": [
          "iceoryx2-log/log/src/lib.rs:144 - LOGGER",
          "iceoryx2-log/loggers/src/writer.rs:19,28 - STDOUT, STDERR",
          "iceoryx2-ffi/c/src/api/log.rs:79 - LOGGER (C binding)",
          "iceoryx2-pal/posix/src/windows/socket.rs:51-52 - WSA_INSTANCE, INITIALIZATION_STATE"
        ],
        "risk": "HIGH - mutable static access requires unsafe"
      },
      "unsafe_traits": {
        "count": 1,
        "trait": "ZeroCopySend",
        "implementations": 219,
        "risk": "MEDIUM - marker trait for IPC-safe types"
      },
      "unions": {
        "count": 42,
        "locations": "iceoryx2-ffi/c/src/api/*.rs",
        "risk": "MEDIUM - FFI boundary requires correct union handling"
      },
      "extern_blocks": {
        "count": 11,
        "risk": "MEDIUM - FFI boundary requires correct type signatures"
      },
      "unsafe_fn": {
        "count": 1763,
        "risk": "MEDIUM - concentrated in PAL and FFI layers"
      }
    },
    "positive_patterns": {
      "no_std_support": "extern crate alloc/core pattern for embedded compatibility (NEW in v0.8.0)",
      "visibility_discipline": "pub(crate) and pub(super) for encapsulation",
      "repr_attributes": "#[repr(C)] for FFI, #[repr(transparent)] for newtypes",
      "const_fn": "Compile-time computation for memory sizes",
      "error_enums": "Explicit error handling via Result<T, E> pattern",
      "trait_bounds": "Send + Sync bounds enforce thread safety",
      "prelude_pattern": "Curated public API via prelude.rs",
      "copy_types": "NEW: StaticString, SemanticString implement Copy for ergonomics"
    }
  }
}